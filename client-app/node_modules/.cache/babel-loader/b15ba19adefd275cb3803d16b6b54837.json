{"ast":null,"code":"import _initializerDefineProperty from \"C:\\\\Projects\\\\Reactivities\\\\client-app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/initializerDefineProperty\";\nimport _applyDecoratedDescriptor from \"C:\\\\Projects\\\\Reactivities\\\\client-app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/applyDecoratedDescriptor\";\nimport _initializerWarningHelper from \"C:\\\\Projects\\\\Reactivities\\\\client-app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/initializerWarningHelper\";\n\nvar _class, _descriptor, _descriptor2, _descriptor3, _descriptor4, _descriptor5, _descriptor6, _descriptor7, _descriptor8, _descriptor9, _descriptor10, _descriptor11, _descriptor12, _descriptor13, _descriptor14, _descriptor15, _descriptor16, _descriptor17, _descriptor18, _temp;\n\nimport { observable, action, runInAction, computed, reaction } from \"mobx\";\nimport agent from \"../api/agent\";\nimport { toast } from \"react-toastify\";\nlet ProfileStore = (_class = (_temp = class ProfileStore {\n  constructor(rootStore) {\n    this.rootStore = void 0;\n\n    _initializerDefineProperty(this, \"profile\", _descriptor, this);\n\n    _initializerDefineProperty(this, \"loadingProfile\", _descriptor2, this);\n\n    _initializerDefineProperty(this, \"uploadingPhoto\", _descriptor3, this);\n\n    _initializerDefineProperty(this, \"loading\", _descriptor4, this);\n\n    _initializerDefineProperty(this, \"followings\", _descriptor5, this);\n\n    _initializerDefineProperty(this, \"activeTab\", _descriptor6, this);\n\n    _initializerDefineProperty(this, \"userActivities\", _descriptor7, this);\n\n    _initializerDefineProperty(this, \"loadingActivities\", _descriptor8, this);\n\n    _initializerDefineProperty(this, \"loadUserActivities\", _descriptor9, this);\n\n    _initializerDefineProperty(this, \"setActiveTab\", _descriptor10, this);\n\n    _initializerDefineProperty(this, \"loadProfile\", _descriptor11, this);\n\n    _initializerDefineProperty(this, \"uploadPhoto\", _descriptor12, this);\n\n    _initializerDefineProperty(this, \"setMainPhoto\", _descriptor13, this);\n\n    _initializerDefineProperty(this, \"deletePhoto\", _descriptor14, this);\n\n    _initializerDefineProperty(this, \"updateProfile\", _descriptor15, this);\n\n    _initializerDefineProperty(this, \"follow\", _descriptor16, this);\n\n    _initializerDefineProperty(this, \"unfollow\", _descriptor17, this);\n\n    _initializerDefineProperty(this, \"loadFollowings\", _descriptor18, this);\n\n    this.rootStore = rootStore;\n    reaction(() => this.activeTab, activeTab => {\n      if (activeTab === 3 || activeTab === 4) {\n        const predicate = activeTab === 3 ? 'followers' : 'following';\n        this.loadFollowings(predicate);\n      } else {\n        this.followings = [];\n      }\n    });\n  }\n\n  get isCurrentUser() {\n    if (this.rootStore.userStore.user && this.profile) {\n      return this.rootStore.userStore.user.username === this.profile.userName;\n    } else {\n      return false;\n    }\n  }\n\n}, _temp), (_descriptor = _applyDecoratedDescriptor(_class.prototype, \"profile\", [observable], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return null;\n  }\n}), _descriptor2 = _applyDecoratedDescriptor(_class.prototype, \"loadingProfile\", [observable], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return true;\n  }\n}), _descriptor3 = _applyDecoratedDescriptor(_class.prototype, \"uploadingPhoto\", [observable], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return false;\n  }\n}), _descriptor4 = _applyDecoratedDescriptor(_class.prototype, \"loading\", [observable], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return false;\n  }\n}), _descriptor5 = _applyDecoratedDescriptor(_class.prototype, \"followings\", [observable], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return [];\n  }\n}), _descriptor6 = _applyDecoratedDescriptor(_class.prototype, \"activeTab\", [observable], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return 0;\n  }\n}), _descriptor7 = _applyDecoratedDescriptor(_class.prototype, \"userActivities\", [observable], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return [];\n  }\n}), _descriptor8 = _applyDecoratedDescriptor(_class.prototype, \"loadingActivities\", [observable], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return false;\n  }\n}), _applyDecoratedDescriptor(_class.prototype, \"isCurrentUser\", [computed], Object.getOwnPropertyDescriptor(_class.prototype, \"isCurrentUser\"), _class.prototype), _descriptor9 = _applyDecoratedDescriptor(_class.prototype, \"loadUserActivities\", [action], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return async (username, predicate) => {\n      this.loadingActivities = true;\n\n      try {\n        const activities = await agent.Profiles.listActivities(username, predicate);\n        runInAction(() => {\n          this.userActivities = activities;\n          this.loadingActivities = false;\n        });\n      } catch (error) {\n        toast.error('Problem loading activities');\n        runInAction(() => {\n          this.loadingActivities = false;\n        });\n      }\n    };\n  }\n}), _descriptor10 = _applyDecoratedDescriptor(_class.prototype, \"setActiveTab\", [action], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return activeIndex => {\n      this.activeTab = activeIndex;\n    };\n  }\n}), _descriptor11 = _applyDecoratedDescriptor(_class.prototype, \"loadProfile\", [action], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return async userName => {\n      try {\n        const profile = await agent.Profiles.get(userName);\n        runInAction(() => {\n          this.profile = profile;\n          this.loadingProfile = false;\n        });\n      } catch (error) {\n        runInAction(() => {\n          this.loadingProfile = false;\n        });\n        console.log(error);\n      }\n    };\n  }\n}), _descriptor12 = _applyDecoratedDescriptor(_class.prototype, \"uploadPhoto\", [action], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return async file => {\n      this.uploadingPhoto = true;\n\n      try {\n        const photo = await agent.Profiles.uploadPhoto(file);\n        runInAction(() => {\n          if (this.profile) {\n            this.profile.photos.push(photo);\n\n            if (photo.isMain && this.rootStore.userStore.user) {\n              this.rootStore.userStore.user.image = photo.url;\n              this.profile.image = photo.url;\n            }\n          }\n\n          this.uploadingPhoto = false;\n        });\n      } catch (error) {\n        console.log(error);\n        toast.error(\"uploading problem photo\");\n        runInAction(() => {\n          this.uploadingPhoto = false;\n        });\n      }\n    };\n  }\n}), _descriptor13 = _applyDecoratedDescriptor(_class.prototype, \"setMainPhoto\", [action], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return async photo => {\n      this.loading = true;\n\n      try {\n        await agent.Profiles.setMainPhoto(photo.id);\n        runInAction(() => {\n          this.rootStore.userStore.user.image = photo.url;\n          this.profile.photos.find(a => a.isMain).isMain = false;\n          this.profile.photos.find(a => a.id === photo.id).isMain = true;\n          this.profile.image = photo.url;\n          this.loading = false;\n        });\n      } catch (error) {\n        toast.error(\"Problem setting photo as main\");\n        runInAction(() => {\n          this.loading = false;\n        });\n      }\n    };\n  }\n}), _descriptor14 = _applyDecoratedDescriptor(_class.prototype, \"deletePhoto\", [action], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return async photo => {\n      this.loading = true;\n\n      try {\n        await agent.Profiles.deletePhoto(photo.id);\n        runInAction(() => {\n          this.profile.photos = this.profile.photos.filter(a => a.id !== photo.id);\n          this.loading = false;\n        });\n      } catch (error) {\n        toast.error(\"Problem deleting photo \");\n        runInAction(() => {\n          this.loading = false;\n        });\n      }\n    };\n  }\n}), _descriptor15 = _applyDecoratedDescriptor(_class.prototype, \"updateProfile\", [action], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return async profile => {\n      try {\n        await agent.Profiles.updateProfile(profile);\n        runInAction(() => {\n          if (profile.display !== this.rootStore.userStore.user.display) {\n            this.rootStore.userStore.user.display = profile.display;\n          }\n\n          this.profile = { ...this.profile,\n            ...profile\n          };\n        });\n      } catch (error) {\n        toast.error(\"Problem updating profile\");\n      }\n    };\n  }\n}), _descriptor16 = _applyDecoratedDescriptor(_class.prototype, \"follow\", [action], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return async username => {\n      this.loading = true;\n\n      try {\n        await agent.Profiles.follow(username);\n        runInAction(() => {\n          this.profile.following = true;\n          this.profile.followersCount++;\n          this.loading = false;\n        });\n      } catch (error) {\n        toast.error(\"Problem following user\");\n        runInAction(() => {\n          this.loading = false;\n        });\n      }\n    };\n  }\n}), _descriptor17 = _applyDecoratedDescriptor(_class.prototype, \"unfollow\", [action], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return async username => {\n      this.loading = true;\n\n      try {\n        await agent.Profiles.unfollow(username);\n        runInAction(() => {\n          this.profile.following = false;\n          this.profile.followersCount--;\n          this.loading = false;\n        });\n      } catch (error) {\n        toast.error(\"Problem unfollowing user\");\n        runInAction(() => {\n          this.loading = false;\n        });\n      }\n    };\n  }\n}), _descriptor18 = _applyDecoratedDescriptor(_class.prototype, \"loadFollowings\", [action], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return async predicate => {\n      this.loading = true;\n\n      try {\n        const profiles = await agent.Profiles.listFollowings(this.profile.userName, predicate);\n        runInAction(() => {\n          this.followings = profiles;\n          this.loading = false;\n        });\n      } catch (error) {\n        toast.error('Problem loading followings');\n        runInAction(() => {\n          this.loading = false;\n        });\n      }\n    };\n  }\n})), _class);\nexport { ProfileStore as default };","map":{"version":3,"sources":["C:/Projects/Reactivities/client-app/src/app/stores/profileStore.ts"],"names":["observable","action","runInAction","computed","reaction","agent","toast","ProfileStore","constructor","rootStore","activeTab","predicate","loadFollowings","followings","isCurrentUser","userStore","user","profile","username","userName","loadingActivities","activities","Profiles","listActivities","userActivities","error","activeIndex","get","loadingProfile","console","log","file","uploadingPhoto","photo","uploadPhoto","photos","push","isMain","image","url","loading","setMainPhoto","id","find","a","deletePhoto","filter","updateProfile","display","follow","following","followersCount","unfollow","profiles","listFollowings"],"mappings":"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","sourcesContent":["import { RootStore } from \"./rootStore\";\r\nimport { IProfile, IPhoto, IUserActivity } from \"../models/profile\";\r\nimport { observable, action, runInAction, computed, reaction } from \"mobx\";\r\nimport agent from \"../api/agent\";\r\nimport { toast } from \"react-toastify\";\r\n\r\nexport default class ProfileStore {\r\n  rootStore: RootStore;\r\n  constructor(rootStore: RootStore) {\r\n    this.rootStore = rootStore;\r\n\r\n    reaction(\r\n      ()=> this.activeTab,\r\n      activeTab => {\r\n        if (activeTab===3 || activeTab ===4) {\r\n          const predicate =activeTab===3 ? 'followers':'following';\r\n          this.loadFollowings(predicate)\r\n        }else {\r\n          this.followings=[];\r\n        }\r\n      }\r\n    )\r\n  }\r\n  @observable profile: IProfile | null = null;\r\n  @observable loadingProfile = true;\r\n  @observable uploadingPhoto = false;\r\n  @observable loading = false;\r\n  @observable followings: IProfile[] = [];\r\n  @observable activeTab: number = 0;\r\n  @observable userActivities:IUserActivity[] = []\r\n  @observable loadingActivities = false;\r\n\r\n  @computed get isCurrentUser() {\r\n    if (this.rootStore.userStore.user && this.profile) {\r\n      return this.rootStore.userStore.user.username === this.profile.userName;\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  @action loadUserActivities = async (username: string, predicate?: string) => {\r\n    this.loadingActivities = true;\r\n    try {\r\n      const activities = await agent.Profiles.listActivities(username, predicate!);\r\n      runInAction(() => {\r\n        this.userActivities = activities;\r\n        this.loadingActivities = false;\r\n      })\r\n    } catch (error) {\r\n      toast.error('Problem loading activities')\r\n      runInAction(() => {\r\n        this.loadingActivities = false;\r\n      })\r\n    }\r\n  }\r\n  @action setActiveTab= (activeIndex: number) => {\r\n    this.activeTab=activeIndex;\r\n  }\r\n  @action loadProfile = async (userName: string) => {\r\n    try {\r\n      const profile = await agent.Profiles.get(userName);\r\n      runInAction(() => {\r\n        this.profile = profile;\r\n\r\n        this.loadingProfile = false;\r\n      });\r\n    } catch (error) {\r\n      runInAction(() => {\r\n        this.loadingProfile = false;\r\n      });\r\n      console.log(error);\r\n    }\r\n  };\r\n\r\n  @action uploadPhoto = async (file: Blob) => {\r\n    this.uploadingPhoto = true;\r\n    try {\r\n      const photo = await agent.Profiles.uploadPhoto(file);\r\n      runInAction(() => {\r\n        if (this.profile) {\r\n          this.profile.photos.push(photo);\r\n          if (photo.isMain && this.rootStore.userStore.user) {\r\n            this.rootStore.userStore.user.image = photo.url;\r\n            this.profile.image = photo.url;\r\n          }\r\n        }\r\n        this.uploadingPhoto = false;\r\n      });\r\n    } catch (error) {\r\n      console.log(error);\r\n      toast.error(\"uploading problem photo\");\r\n      runInAction(() => {\r\n        this.uploadingPhoto = false;\r\n      });\r\n    }\r\n  };\r\n  @action setMainPhoto = async (photo: IPhoto) => {\r\n    this.loading = true;\r\n    try {\r\n      await agent.Profiles.setMainPhoto(photo.id);\r\n      runInAction(() => {\r\n        this.rootStore.userStore.user!.image = photo.url;\r\n        this.profile!.photos.find((a) => a.isMain)!.isMain = false;\r\n        this.profile!.photos.find((a) => a.id === photo.id)!.isMain = true;\r\n        this.profile!.image = photo.url;\r\n        this.loading = false;\r\n      });\r\n    } catch (error) {\r\n      toast.error(\"Problem setting photo as main\");\r\n      runInAction(() => {\r\n        this.loading = false;\r\n      });\r\n    }\r\n  };\r\n  @action deletePhoto = async (photo: IPhoto) => {\r\n    this.loading = true;\r\n    try {\r\n      await agent.Profiles.deletePhoto(photo.id);\r\n      runInAction(() => {\r\n        this.profile!.photos = this.profile!.photos.filter(\r\n          (a) => a.id !== photo.id\r\n        );\r\n        this.loading = false;\r\n      });\r\n    } catch (error) {\r\n      toast.error(\"Problem deleting photo \");\r\n      runInAction(() => {\r\n        this.loading = false;\r\n      });\r\n    }\r\n  };\r\n\r\n  @action updateProfile = async (profile: Partial<IProfile>) => {\r\n    try {\r\n      await agent.Profiles.updateProfile(profile);\r\n      runInAction(() => {\r\n        if (profile.display !== this.rootStore.userStore.user!.display) {\r\n          this.rootStore.userStore.user!.display = profile.display!;\r\n        }\r\n        this.profile = { ...this.profile!, ...profile };\r\n      });\r\n    } catch (error) {\r\n      toast.error(\"Problem updating profile\");\r\n    }\r\n  };\r\n  @action follow = async (username: string) => {\r\n    this.loading = true;\r\n    try {\r\n      await agent.Profiles.follow(username);\r\n      runInAction(() => {\r\n        this.profile!.following = true;\r\n        this.profile!.followersCount++;\r\n        this.loading = false;\r\n      });\r\n    } catch (error) {\r\n      toast.error(\"Problem following user\");\r\n      runInAction(() => {\r\n        this.loading = false;\r\n      });\r\n    }\r\n  };\r\n\r\n  @action unfollow = async (username: string) => {\r\n    this.loading = true;\r\n    try {\r\n      await agent.Profiles.unfollow(username);\r\n      runInAction(() => {\r\n        this.profile!.following = false;\r\n        this.profile!.followersCount--;\r\n        this.loading = false;\r\n      });\r\n    } catch (error) {\r\n      toast.error(\"Problem unfollowing user\");\r\n      runInAction(() => {\r\n        this.loading = false;\r\n      });\r\n    }\r\n  };\r\n\r\n  @action loadFollowings = async (predicate: string) => {\r\n    this.loading = true;\r\n    try {\r\n      const profiles = await agent.Profiles.listFollowings(\r\n        this.profile!.userName,\r\n        predicate\r\n      );\r\n      runInAction(() => {\r\n          this.followings = profiles;\r\n          this.loading = false;\r\n      })\r\n    } catch (error) {\r\n      toast.error('Problem loading followings');\r\n      runInAction(() => {\r\n        this.loading = false;\r\n      });\r\n    }\r\n  };\r\n}\r\n"]},"metadata":{},"sourceType":"module"}