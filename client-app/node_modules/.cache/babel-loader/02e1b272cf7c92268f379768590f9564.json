{"ast":null,"code":"/**\n * @ag-grid-community/core - Advanced Data Grid / Data Table supporting Javascript / React / AngularJS / Web Components\n * @version v22.1.1\n * @link http://www.ag-grid.com/\n * @license MIT\n */\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nvar __param = this && this.__param || function (paramIndex, decorator) {\n  return function (target, key) {\n    decorator(target, key, paramIndex);\n  };\n};\n\nimport { Qualifier, PostConstruct, Bean, Autowired, PreDestroy } from \"../context/context\";\nimport { _ } from \"../utils\";\nexport var DragSourceType;\n\n(function (DragSourceType) {\n  DragSourceType[DragSourceType[\"ToolPanel\"] = 0] = \"ToolPanel\";\n  DragSourceType[DragSourceType[\"HeaderCell\"] = 1] = \"HeaderCell\";\n  DragSourceType[DragSourceType[\"RowDrag\"] = 2] = \"RowDrag\";\n  DragSourceType[DragSourceType[\"ChartPanel\"] = 3] = \"ChartPanel\";\n})(DragSourceType || (DragSourceType = {}));\n\nexport var VerticalDirection;\n\n(function (VerticalDirection) {\n  VerticalDirection[VerticalDirection[\"Up\"] = 0] = \"Up\";\n  VerticalDirection[VerticalDirection[\"Down\"] = 1] = \"Down\";\n})(VerticalDirection || (VerticalDirection = {}));\n\nexport var HorizontalDirection;\n\n(function (HorizontalDirection) {\n  HorizontalDirection[HorizontalDirection[\"Left\"] = 0] = \"Left\";\n  HorizontalDirection[HorizontalDirection[\"Right\"] = 1] = \"Right\";\n})(HorizontalDirection || (HorizontalDirection = {}));\n\nvar DragAndDropService =\n/** @class */\nfunction () {\n  function DragAndDropService() {\n    this.dragSourceAndParamsList = [];\n    this.dropTargets = [];\n  }\n\n  DragAndDropService_1 = DragAndDropService;\n\n  DragAndDropService.prototype.init = function () {\n    this.ePinnedIcon = _.createIcon('columnMovePin', this.gridOptionsWrapper, null);\n    this.ePlusIcon = _.createIcon('columnMoveAdd', this.gridOptionsWrapper, null);\n    this.eHiddenIcon = _.createIcon('columnMoveHide', this.gridOptionsWrapper, null);\n    this.eMoveIcon = _.createIcon('columnMoveMove', this.gridOptionsWrapper, null);\n    this.eLeftIcon = _.createIcon('columnMoveLeft', this.gridOptionsWrapper, null);\n    this.eRightIcon = _.createIcon('columnMoveRight', this.gridOptionsWrapper, null);\n    this.eGroupIcon = _.createIcon('columnMoveGroup', this.gridOptionsWrapper, null);\n    this.eAggregateIcon = _.createIcon('columnMoveValue', this.gridOptionsWrapper, null);\n    this.ePivotIcon = _.createIcon('columnMovePivot', this.gridOptionsWrapper, null);\n    this.eDropNotAllowedIcon = _.createIcon('dropNotAllowed', this.gridOptionsWrapper, null);\n  };\n\n  DragAndDropService.prototype.setBeans = function (loggerFactory) {\n    this.logger = loggerFactory.create('OldToolPanelDragAndDropService');\n  };\n\n  DragAndDropService.prototype.addDragSource = function (dragSource, allowTouch) {\n    if (allowTouch === void 0) {\n      allowTouch = false;\n    }\n\n    var params = {\n      eElement: dragSource.eElement,\n      dragStartPixels: dragSource.dragStartPixels,\n      onDragStart: this.onDragStart.bind(this, dragSource),\n      onDragStop: this.onDragStop.bind(this),\n      onDragging: this.onDragging.bind(this)\n    };\n    this.dragSourceAndParamsList.push({\n      params: params,\n      dragSource: dragSource\n    });\n    this.dragService.addDragSource(params, allowTouch);\n  };\n\n  DragAndDropService.prototype.removeDragSource = function (dragSource) {\n    var sourceAndParams = _.find(this.dragSourceAndParamsList, function (item) {\n      return item.dragSource === dragSource;\n    });\n\n    if (sourceAndParams) {\n      this.dragService.removeDragSource(sourceAndParams.params);\n\n      _.removeFromArray(this.dragSourceAndParamsList, sourceAndParams);\n    }\n  };\n\n  DragAndDropService.prototype.destroy = function () {\n    var _this = this;\n\n    this.dragSourceAndParamsList.forEach(function (sourceAndParams) {\n      return _this.dragService.removeDragSource(sourceAndParams.params);\n    });\n    this.dragSourceAndParamsList.length = 0;\n  };\n\n  DragAndDropService.prototype.nudge = function () {\n    if (this.dragging) {\n      this.onDragging(this.eventLastTime, true);\n    }\n  };\n\n  DragAndDropService.prototype.onDragStart = function (dragSource, mouseEvent) {\n    this.dragging = true;\n    this.dragSource = dragSource;\n    this.eventLastTime = mouseEvent;\n    this.dragItem = this.dragSource.getDragItem();\n    this.lastDropTarget = this.dragSource.dragSourceDropTarget;\n\n    if (this.dragSource.onDragStarted) {\n      this.dragSource.onDragStarted();\n    }\n\n    this.createGhost();\n  };\n\n  DragAndDropService.prototype.onDragStop = function (mouseEvent) {\n    this.eventLastTime = null;\n    this.dragging = false;\n\n    if (this.dragSource.onDragStopped) {\n      this.dragSource.onDragStopped();\n    }\n\n    if (this.lastDropTarget && this.lastDropTarget.onDragStop) {\n      var draggingEvent = this.createDropTargetEvent(this.lastDropTarget, mouseEvent, null, null, false);\n      this.lastDropTarget.onDragStop(draggingEvent);\n    }\n\n    this.lastDropTarget = null;\n    this.dragItem = null;\n    this.removeGhost();\n  };\n\n  DragAndDropService.prototype.onDragging = function (mouseEvent, fromNudge) {\n    var hDirection = this.getHorizontalDirection(mouseEvent);\n    var vDirection = this.getVerticalDirection(mouseEvent);\n    this.eventLastTime = mouseEvent;\n    this.positionGhost(mouseEvent); // check if mouseEvent intersects with any of the drop targets\n\n    var dropTarget = _.find(this.dropTargets, this.isMouseOnDropTarget.bind(this, mouseEvent));\n\n    if (dropTarget !== this.lastDropTarget) {\n      this.leaveLastTargetIfExists(mouseEvent, hDirection, vDirection, fromNudge);\n      this.enterDragTargetIfExists(dropTarget, mouseEvent, hDirection, vDirection, fromNudge);\n      this.lastDropTarget = dropTarget;\n    } else if (dropTarget) {\n      var draggingEvent = this.createDropTargetEvent(dropTarget, mouseEvent, hDirection, vDirection, fromNudge);\n      dropTarget.onDragging(draggingEvent);\n    }\n  };\n\n  DragAndDropService.prototype.enterDragTargetIfExists = function (dropTarget, mouseEvent, hDirection, vDirection, fromNudge) {\n    if (!dropTarget) {\n      return;\n    }\n\n    if (dropTarget.onDragEnter) {\n      var dragEnterEvent = this.createDropTargetEvent(dropTarget, mouseEvent, hDirection, vDirection, fromNudge);\n      dropTarget.onDragEnter(dragEnterEvent);\n    }\n\n    this.setGhostIcon(dropTarget.getIconName ? dropTarget.getIconName() : null);\n  };\n\n  DragAndDropService.prototype.leaveLastTargetIfExists = function (mouseEvent, hDirection, vDirection, fromNudge) {\n    if (!this.lastDropTarget) {\n      return;\n    }\n\n    if (this.lastDropTarget.onDragLeave) {\n      var dragLeaveEvent = this.createDropTargetEvent(this.lastDropTarget, mouseEvent, hDirection, vDirection, fromNudge);\n      this.lastDropTarget.onDragLeave(dragLeaveEvent);\n    }\n\n    this.setGhostIcon(null);\n  };\n\n  DragAndDropService.prototype.getAllContainersFromDropTarget = function (dropTarget) {\n    var containers = [dropTarget.getContainer()];\n    var secondaryContainers = dropTarget.getSecondaryContainers ? dropTarget.getSecondaryContainers() : null;\n\n    if (secondaryContainers) {\n      containers = containers.concat(secondaryContainers);\n    }\n\n    return containers;\n  }; // checks if the mouse is on the drop target. it checks eContainer and eSecondaryContainers\n\n\n  DragAndDropService.prototype.isMouseOnDropTarget = function (mouseEvent, dropTarget) {\n    var mouseOverTarget = false;\n    this.getAllContainersFromDropTarget(dropTarget).filter(function (eContainer) {\n      return eContainer;\n    }) // secondary can be missing\n    .forEach(function (eContainer) {\n      var rect = eContainer.getBoundingClientRect(); // if element is not visible, then width and height are zero\n\n      if (rect.width === 0 || rect.height === 0) {\n        return;\n      }\n\n      var horizontalFit = mouseEvent.clientX >= rect.left && mouseEvent.clientX <= rect.right;\n      var verticalFit = mouseEvent.clientY >= rect.top && mouseEvent.clientY <= rect.bottom;\n\n      if (horizontalFit && verticalFit) {\n        mouseOverTarget = true;\n      }\n    });\n    return mouseOverTarget && dropTarget.isInterestedIn(this.dragSource.type);\n  };\n\n  DragAndDropService.prototype.addDropTarget = function (dropTarget) {\n    this.dropTargets.push(dropTarget);\n  };\n\n  DragAndDropService.prototype.getHorizontalDirection = function (event) {\n    if (this.eventLastTime.clientX > event.clientX) {\n      return HorizontalDirection.Left;\n    } else if (this.eventLastTime.clientX < event.clientX) {\n      return HorizontalDirection.Right;\n    } else {\n      return null;\n    }\n  };\n\n  DragAndDropService.prototype.getVerticalDirection = function (event) {\n    if (this.eventLastTime.clientY > event.clientY) {\n      return VerticalDirection.Up;\n    } else if (this.eventLastTime.clientY < event.clientY) {\n      return VerticalDirection.Down;\n    } else {\n      return null;\n    }\n  };\n\n  DragAndDropService.prototype.createDropTargetEvent = function (dropTarget, event, hDirection, vDirection, fromNudge) {\n    // localise x and y to the target component\n    var rect = dropTarget.getContainer().getBoundingClientRect();\n    var x = event.clientX - rect.left;\n    var y = event.clientY - rect.top;\n    return {\n      event: event,\n      x: x,\n      y: y,\n      vDirection: vDirection,\n      hDirection: hDirection,\n      dragSource: this.dragSource,\n      fromNudge: fromNudge,\n      dragItem: this.dragItem\n    };\n  };\n\n  DragAndDropService.prototype.positionGhost = function (event) {\n    var ghostRect = this.eGhost.getBoundingClientRect();\n    var ghostHeight = ghostRect.height; // for some reason, without the '-2', it still overlapped by 1 or 2 pixels, which\n    // then brought in scrollbars to the browser. no idea why, but putting in -2 here\n    // works around it which is good enough for me.\n\n    var browserWidth = _.getBodyWidth() - 2;\n    var browserHeight = _.getBodyHeight() - 2; // put ghost vertically in middle of cursor\n\n    var top = event.pageY - ghostHeight / 2; // horizontally, place cursor just right of icon\n\n    var left = event.pageX - 30;\n    var usrDocument = this.gridOptionsWrapper.getDocument();\n    var windowScrollY = window.pageYOffset || usrDocument.documentElement.scrollTop;\n    var windowScrollX = window.pageXOffset || usrDocument.documentElement.scrollLeft; // check ghost is not positioned outside of the browser\n\n    if (browserWidth > 0 && left + this.eGhost.clientWidth > browserWidth + windowScrollX) {\n      left = browserWidth + windowScrollX - this.eGhost.clientWidth;\n    }\n\n    if (left < 0) {\n      left = 0;\n    }\n\n    if (browserHeight > 0 && top + this.eGhost.clientHeight > browserHeight + windowScrollY) {\n      top = browserHeight + windowScrollY - this.eGhost.clientHeight;\n    }\n\n    if (top < 0) {\n      top = 0;\n    }\n\n    this.eGhost.style.left = left + 'px';\n    this.eGhost.style.top = top + 'px';\n  };\n\n  DragAndDropService.prototype.removeGhost = function () {\n    if (this.eGhost && this.eGhostParent) {\n      this.eGhostParent.removeChild(this.eGhost);\n    }\n\n    this.eGhost = null;\n  };\n\n  DragAndDropService.prototype.createGhost = function () {\n    this.eGhost = _.loadTemplate(DragAndDropService_1.GHOST_TEMPLATE);\n    var theme = this.environment.getTheme().theme;\n\n    if (theme) {\n      _.addCssClass(this.eGhost, theme);\n    }\n\n    this.eGhostIcon = this.eGhost.querySelector('.ag-dnd-ghost-icon');\n    this.setGhostIcon(null);\n    var eText = this.eGhost.querySelector('.ag-dnd-ghost-label');\n    eText.innerHTML = _.escape(this.dragSource.dragItemName);\n    this.eGhost.style.height = '25px';\n    this.eGhost.style.top = '20px';\n    this.eGhost.style.left = '20px';\n    var usrDocument = this.gridOptionsWrapper.getDocument();\n    this.eGhostParent = usrDocument.querySelector('body');\n\n    if (!this.eGhostParent) {\n      console.warn('ag-Grid: could not find document body, it is needed for dragging columns');\n    } else {\n      this.eGhostParent.appendChild(this.eGhost);\n    }\n  };\n\n  DragAndDropService.prototype.setGhostIcon = function (iconName, shake) {\n    if (shake === void 0) {\n      shake = false;\n    }\n\n    _.clearElement(this.eGhostIcon);\n\n    var eIcon;\n\n    switch (iconName) {\n      case DragAndDropService_1.ICON_ADD:\n        eIcon = this.ePlusIcon;\n        break;\n\n      case DragAndDropService_1.ICON_PINNED:\n        eIcon = this.ePinnedIcon;\n        break;\n\n      case DragAndDropService_1.ICON_MOVE:\n        eIcon = this.eMoveIcon;\n        break;\n\n      case DragAndDropService_1.ICON_LEFT:\n        eIcon = this.eLeftIcon;\n        break;\n\n      case DragAndDropService_1.ICON_RIGHT:\n        eIcon = this.eRightIcon;\n        break;\n\n      case DragAndDropService_1.ICON_GROUP:\n        eIcon = this.eGroupIcon;\n        break;\n\n      case DragAndDropService_1.ICON_AGGREGATE:\n        eIcon = this.eAggregateIcon;\n        break;\n\n      case DragAndDropService_1.ICON_PIVOT:\n        eIcon = this.ePivotIcon;\n        break;\n\n      case DragAndDropService_1.ICON_NOT_ALLOWED:\n        eIcon = this.eDropNotAllowedIcon;\n        break;\n\n      default:\n        eIcon = this.eHiddenIcon;\n        break;\n    }\n\n    this.eGhostIcon.appendChild(eIcon);\n\n    _.addOrRemoveCssClass(this.eGhostIcon, 'ag-shake-left-to-right', shake);\n  };\n\n  var DragAndDropService_1;\n  DragAndDropService.ICON_PINNED = 'pinned';\n  DragAndDropService.ICON_ADD = 'add';\n  DragAndDropService.ICON_MOVE = 'move';\n  DragAndDropService.ICON_LEFT = 'left';\n  DragAndDropService.ICON_RIGHT = 'right';\n  DragAndDropService.ICON_GROUP = 'group';\n  DragAndDropService.ICON_AGGREGATE = 'aggregate';\n  DragAndDropService.ICON_PIVOT = 'pivot';\n  DragAndDropService.ICON_NOT_ALLOWED = 'notAllowed';\n  DragAndDropService.GHOST_TEMPLATE = '<div class=\"ag-dnd-ghost\">' + '  <span class=\"ag-dnd-ghost-icon ag-shake-left-to-right\"></span>' + '  <div class=\"ag-dnd-ghost-label\">' + '  </div>' + '</div>';\n\n  __decorate([Autowired('gridOptionsWrapper')], DragAndDropService.prototype, \"gridOptionsWrapper\", void 0);\n\n  __decorate([Autowired('dragService')], DragAndDropService.prototype, \"dragService\", void 0);\n\n  __decorate([Autowired('environment')], DragAndDropService.prototype, \"environment\", void 0);\n\n  __decorate([PostConstruct], DragAndDropService.prototype, \"init\", null);\n\n  __decorate([__param(0, Qualifier('loggerFactory'))], DragAndDropService.prototype, \"setBeans\", null);\n\n  __decorate([PreDestroy], DragAndDropService.prototype, \"destroy\", null);\n\n  DragAndDropService = DragAndDropService_1 = __decorate([Bean('dragAndDropService')], DragAndDropService);\n  return DragAndDropService;\n}();\n\nexport { DragAndDropService };","map":null,"metadata":{},"sourceType":"module"}