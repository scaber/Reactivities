{"ast":null,"code":"/**\n * @ag-grid-community/core - Advanced Data Grid / Data Table supporting Javascript / React / AngularJS / Web Components\n * @version v22.1.1\n * @link http://www.ag-grid.com/\n * @license MIT\n */\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nimport { Bean, Autowired, PostConstruct } from \"./context/context\";\nimport { Events } from \"./events\";\nimport { CellComp } from \"./rendering/cellComp\";\nimport { _ } from \"./utils\";\n\nvar FocusedCellController =\n/** @class */\nfunction () {\n  function FocusedCellController() {}\n\n  FocusedCellController.prototype.init = function () {\n    this.eventService.addEventListener(Events.EVENT_COLUMN_PIVOT_MODE_CHANGED, this.clearFocusedCell.bind(this));\n    this.eventService.addEventListener(Events.EVENT_COLUMN_EVERYTHING_CHANGED, this.clearFocusedCell.bind(this));\n    this.eventService.addEventListener(Events.EVENT_COLUMN_GROUP_OPENED, this.clearFocusedCell.bind(this));\n    this.eventService.addEventListener(Events.EVENT_COLUMN_ROW_GROUP_CHANGED, this.clearFocusedCell.bind(this)); // we used to remove focus when moving column, am not sure why. so taking this out and see who complains.\n    // we can delete these three lines of code soon.\n    // this.eventService.addEventListener(Events.EVENT_COLUMN_MOVED, this.clearFocusedCell.bind(this));\n    // this.eventService.addEventListener(Events.EVENT_COLUMN_PINNED, this.clearFocusedCell.bind(this));\n    // this.eventService.addEventListener(Events.EVENT_COLUMN_VISIBLE, this.clearFocusedCell.bind(this));\n  };\n\n  FocusedCellController.prototype.clearFocusedCell = function () {\n    this.focusedCellPosition = null;\n    this.onCellFocused(false);\n  };\n\n  FocusedCellController.prototype.getFocusedCell = function () {\n    return this.focusedCellPosition;\n  }; // we check if the browser is focusing something, and if it is, and\n  // it's the cell we think is focused, then return the cell. so this\n  // methods returns the cell if a) we think it has focus and b) the\n  // browser thinks it has focus. this then returns nothing if we\n  // first focus a cell, then second click outside the grid, as then the\n  // grid cell will still be focused as far as the grid is concerned,\n  // however the browser focus will have moved somewhere else.\n\n\n  FocusedCellController.prototype.getFocusCellToUseAfterRefresh = function () {\n    if (this.gridOptionsWrapper.isSuppressFocusAfterRefresh()) {\n      return null;\n    }\n\n    if (!this.focusedCellPosition) {\n      return null;\n    } // we check that the browser is actually focusing on the grid, if it is not, then\n    // we have nothing to worry about\n\n\n    var browserFocusedCell = this.getGridCellForDomElement(document.activeElement);\n\n    if (!browserFocusedCell) {\n      return null;\n    }\n\n    return this.focusedCellPosition;\n  };\n\n  FocusedCellController.prototype.getGridCellForDomElement = function (eBrowserCell) {\n    var ePointer = eBrowserCell;\n\n    while (ePointer) {\n      var cellComp = this.gridOptionsWrapper.getDomData(ePointer, CellComp.DOM_DATA_KEY_CELL_COMP);\n\n      if (cellComp) {\n        return cellComp.getCellPosition();\n      }\n\n      ePointer = ePointer.parentNode;\n    }\n\n    return null;\n  };\n\n  FocusedCellController.prototype.setFocusedCell = function (rowIndex, colKey, floating, forceBrowserFocus) {\n    if (forceBrowserFocus === void 0) {\n      forceBrowserFocus = false;\n    }\n\n    var column = _.makeNull(this.columnController.getGridColumn(colKey));\n\n    this.focusedCellPosition = {\n      rowIndex: rowIndex,\n      rowPinned: _.makeNull(floating),\n      column: column\n    };\n    this.onCellFocused(forceBrowserFocus);\n  };\n\n  FocusedCellController.prototype.isCellFocused = function (cellPosition) {\n    if (_.missing(this.focusedCellPosition)) {\n      return false;\n    }\n\n    return this.focusedCellPosition.column === cellPosition.column && this.isRowFocused(cellPosition.rowIndex, cellPosition.rowPinned);\n  };\n\n  FocusedCellController.prototype.isRowNodeFocused = function (rowNode) {\n    return this.isRowFocused(rowNode.rowIndex, rowNode.rowPinned);\n  };\n\n  FocusedCellController.prototype.isAnyCellFocused = function () {\n    return !!this.focusedCellPosition;\n  };\n\n  FocusedCellController.prototype.isRowFocused = function (rowIndex, floating) {\n    if (_.missing(this.focusedCellPosition)) {\n      return false;\n    }\n\n    var floatingOrNull = _.makeNull(floating);\n\n    return this.focusedCellPosition.rowIndex === rowIndex && this.focusedCellPosition.rowPinned === floatingOrNull;\n  };\n\n  FocusedCellController.prototype.onCellFocused = function (forceBrowserFocus) {\n    var event = {\n      type: Events.EVENT_CELL_FOCUSED,\n      forceBrowserFocus: forceBrowserFocus,\n      rowIndex: null,\n      column: null,\n      floating: null,\n      api: this.gridApi,\n      columnApi: this.columnApi,\n      rowPinned: null\n    };\n\n    if (this.focusedCellPosition) {\n      event.rowIndex = this.focusedCellPosition.rowIndex;\n      event.column = this.focusedCellPosition.column;\n      event.rowPinned = this.focusedCellPosition.rowPinned;\n    }\n\n    this.eventService.dispatchEvent(event);\n  };\n\n  __decorate([Autowired('eventService')], FocusedCellController.prototype, \"eventService\", void 0);\n\n  __decorate([Autowired('gridOptionsWrapper')], FocusedCellController.prototype, \"gridOptionsWrapper\", void 0);\n\n  __decorate([Autowired('columnController')], FocusedCellController.prototype, \"columnController\", void 0);\n\n  __decorate([Autowired('columnApi')], FocusedCellController.prototype, \"columnApi\", void 0);\n\n  __decorate([Autowired('gridApi')], FocusedCellController.prototype, \"gridApi\", void 0);\n\n  __decorate([PostConstruct], FocusedCellController.prototype, \"init\", null);\n\n  FocusedCellController = __decorate([Bean('focusedCellController')], FocusedCellController);\n  return FocusedCellController;\n}();\n\nexport { FocusedCellController };","map":null,"metadata":{},"sourceType":"module"}