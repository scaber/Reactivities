{"ast":null,"code":"import _objectSpread from\"C:\\\\Projects\\\\Reactivities\\\\client-app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"C:\\\\Projects\\\\Reactivities\\\\client-app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"C:\\\\Projects\\\\Reactivities\\\\client-app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _initializerDefineProperty from\"C:\\\\Projects\\\\Reactivities\\\\client-app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/initializerDefineProperty\";import _classCallCheck from\"C:\\\\Projects\\\\Reactivities\\\\client-app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"C:\\\\Projects\\\\Reactivities\\\\client-app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _applyDecoratedDescriptor from\"C:\\\\Projects\\\\Reactivities\\\\client-app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/applyDecoratedDescriptor\";import _initializerWarningHelper from\"C:\\\\Projects\\\\Reactivities\\\\client-app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/initializerWarningHelper\";var _class,_descriptor,_descriptor2,_descriptor3,_descriptor4,_descriptor5,_descriptor6,_descriptor7,_descriptor8,_descriptor9,_temp;import{observable,action,runInAction,computed}from\"mobx\";import agent from\"../api/agent\";import{toast}from\"react-toastify\";var ProfileStore=(_class=(_temp=/*#__PURE__*/function(){function ProfileStore(rootStore){_classCallCheck(this,ProfileStore);this.rootStore=void 0;_initializerDefineProperty(this,\"profile\",_descriptor,this);_initializerDefineProperty(this,\"loadingProfile\",_descriptor2,this);_initializerDefineProperty(this,\"uploadingPhoto\",_descriptor3,this);_initializerDefineProperty(this,\"loading\",_descriptor4,this);_initializerDefineProperty(this,\"loadProfile\",_descriptor5,this);_initializerDefineProperty(this,\"uploadPhoto\",_descriptor6,this);_initializerDefineProperty(this,\"setMainPhoto\",_descriptor7,this);_initializerDefineProperty(this,\"deletePhoto\",_descriptor8,this);_initializerDefineProperty(this,\"updateProfile\",_descriptor9,this);this.rootStore=rootStore;}_createClass(ProfileStore,[{key:\"isCurrentUser\",get:function get(){if(this.rootStore.userStore.user&&this.profile){return this.rootStore.userStore.user.username===this.profile.userName;}else{return false;}}}]);return ProfileStore;}(),_temp),(_descriptor=_applyDecoratedDescriptor(_class.prototype,\"profile\",[observable],{configurable:true,enumerable:true,writable:true,initializer:function initializer(){return null;}}),_descriptor2=_applyDecoratedDescriptor(_class.prototype,\"loadingProfile\",[observable],{configurable:true,enumerable:true,writable:true,initializer:function initializer(){return true;}}),_descriptor3=_applyDecoratedDescriptor(_class.prototype,\"uploadingPhoto\",[observable],{configurable:true,enumerable:true,writable:true,initializer:function initializer(){return false;}}),_descriptor4=_applyDecoratedDescriptor(_class.prototype,\"loading\",[observable],{configurable:true,enumerable:true,writable:true,initializer:function initializer(){return false;}}),_applyDecoratedDescriptor(_class.prototype,\"isCurrentUser\",[computed],Object.getOwnPropertyDescriptor(_class.prototype,\"isCurrentUser\"),_class.prototype),_descriptor5=_applyDecoratedDescriptor(_class.prototype,\"loadProfile\",[action],{configurable:true,enumerable:true,writable:true,initializer:function initializer(){var _this=this;return/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(userName){var profile;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return agent.Profiles.get(userName);case 3:profile=_context.sent;runInAction(function(){_this.profile=profile;_this.loadingProfile=false;});_context.next=11;break;case 7:_context.prev=7;_context.t0=_context[\"catch\"](0);runInAction(function(){_this.loadingProfile=false;});console.log(_context.t0);case 11:case\"end\":return _context.stop();}}},_callee,null,[[0,7]]);}));return function(_x){return _ref.apply(this,arguments);};}();}}),_descriptor6=_applyDecoratedDescriptor(_class.prototype,\"uploadPhoto\",[action],{configurable:true,enumerable:true,writable:true,initializer:function initializer(){var _this2=this;return/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(file){var photo;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_this2.uploadingPhoto=true;_context2.prev=1;_context2.next=4;return agent.Profiles.uploadPhoto(file);case 4:photo=_context2.sent;runInAction(function(){if(_this2.profile){_this2.profile.photos.push(photo);if(photo.isMain&&_this2.rootStore.userStore.user){_this2.rootStore.userStore.user.image=photo.url;_this2.profile.image=photo.url;}}_this2.uploadingPhoto=false;});_context2.next=13;break;case 8:_context2.prev=8;_context2.t0=_context2[\"catch\"](1);console.log(_context2.t0);toast.error('uploading problem photo');runInAction(function(){_this2.uploadingPhoto=false;});case 13:case\"end\":return _context2.stop();}}},_callee2,null,[[1,8]]);}));return function(_x2){return _ref2.apply(this,arguments);};}();}}),_descriptor7=_applyDecoratedDescriptor(_class.prototype,\"setMainPhoto\",[action],{configurable:true,enumerable:true,writable:true,initializer:function initializer(){var _this3=this;return/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(photo){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_this3.loading=true;_context3.prev=1;_context3.next=4;return agent.Profiles.setMainPhoto(photo.id);case 4:runInAction(function(){_this3.rootStore.userStore.user.image=photo.url;_this3.profile.photos.find(function(a){return a.isMain;}).isMain=false;_this3.profile.photos.find(function(a){return a.id===photo.id;}).isMain=true;_this3.profile.image=photo.url;_this3.loading=false;});_context3.next=11;break;case 7:_context3.prev=7;_context3.t0=_context3[\"catch\"](1);toast.error('Problem setting photo as main');runInAction(function(){_this3.loading=false;});case 11:case\"end\":return _context3.stop();}}},_callee3,null,[[1,7]]);}));return function(_x3){return _ref3.apply(this,arguments);};}();}}),_descriptor8=_applyDecoratedDescriptor(_class.prototype,\"deletePhoto\",[action],{configurable:true,enumerable:true,writable:true,initializer:function initializer(){var _this4=this;return/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(photo){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_this4.loading=true;_context4.prev=1;_context4.next=4;return agent.Profiles.deletePhoto(photo.id);case 4:runInAction(function(){_this4.profile.photos=_this4.profile.photos.filter(function(a){return a.id!==photo.id;});_this4.loading=false;});_context4.next=11;break;case 7:_context4.prev=7;_context4.t0=_context4[\"catch\"](1);toast.error('Problem deleting photo ');runInAction(function(){_this4.loading=false;});case 11:case\"end\":return _context4.stop();}}},_callee4,null,[[1,7]]);}));return function(_x4){return _ref4.apply(this,arguments);};}();}}),_descriptor9=_applyDecoratedDescriptor(_class.prototype,\"updateProfile\",[action],{configurable:true,enumerable:true,writable:true,initializer:function initializer(){var _this5=this;return/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(profile){return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.prev=0;_context5.next=3;return agent.Profiles.updateProfile(profile);case 3:runInAction(function(){if(profile.display!==_this5.rootStore.userStore.user.display){_this5.rootStore.userStore.user.display=profile.display;}_this5.profile=_objectSpread(_objectSpread({},_this5.profile),profile);});_context5.next=9;break;case 6:_context5.prev=6;_context5.t0=_context5[\"catch\"](0);toast.error('Problem updating profile');case 9:case\"end\":return _context5.stop();}}},_callee5,null,[[0,6]]);}));return function(_x5){return _ref5.apply(this,arguments);};}();}})),_class);export{ProfileStore as default};","map":{"version":3,"sources":["C:/Projects/Reactivities/client-app/src/app/stores/profileStore.ts"],"names":["observable","action","runInAction","computed","agent","toast","ProfileStore","rootStore","userStore","user","profile","username","userName","Profiles","get","loadingProfile","console","log","file","uploadingPhoto","uploadPhoto","photo","photos","push","isMain","image","url","error","loading","setMainPhoto","id","find","a","deletePhoto","filter","updateProfile","display"],"mappings":"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","sourcesContent":["import { RootStore } from \"./rootStore\";\r\nimport { IProfile, IPhoto } from \"../models/profile\";\r\nimport { observable, action, runInAction, computed } from \"mobx\";\r\nimport agent from \"../api/agent\";\r\nimport { toast } from \"react-toastify\";\r\n\r\nexport default class ProfileStore {\r\n    rootStore:RootStore\r\n    constructor(rootStore:RootStore){\r\n        this.rootStore=rootStore\r\n    }\r\n    @observable profile: IProfile | null =null;\r\n    @observable loadingProfile =true;\r\n    @observable uploadingPhoto =false;\r\n    @observable loading =false;\r\n\r\n\r\n\r\n    @computed get isCurrentUser() {\r\n         \r\n        if (this.rootStore.userStore.user && this.profile) {\r\n            return this.rootStore.userStore.user.username === this.profile.userName;\r\n        } else {\r\n            return false;\r\n        }\r\n    }\r\n    @action loadProfile =async (userName:string) => {\r\n \r\n        try {\r\n            const profile =await agent.Profiles.get(userName);\r\n            runInAction(() => {\r\n                this.profile =profile;\r\n                 \r\n                this.loadingProfile=false;\r\n            })\r\n        } catch (error) {\r\n            runInAction(() => {\r\n                this.loadingProfile=false;\r\n            })\r\n            console.log(error);\r\n        } \r\n    }\r\n\r\n    @action uploadPhoto =async (file: Blob) => {\r\n        this.uploadingPhoto=true;\r\n        try {\r\n            const photo =await agent.Profiles.uploadPhoto(file);\r\n            runInAction(()=> {\r\n                if (this.profile) {\r\n                    this.profile.photos.push(photo);\r\n                    if (photo.isMain && this.rootStore.userStore.user) {\r\n                        this.rootStore.userStore.user.image = photo.url;\r\n                        this.profile.image=photo.url;\r\n                    }\r\n                }\r\n                this.uploadingPhoto=false;\r\n\r\n            })\r\n        } catch (error) {\r\n            console.log(error);\r\n            toast.error('uploading problem photo');\r\n            runInAction(() => {\r\n                this.uploadingPhoto=false\r\n            })\r\n        }\r\n    }\r\n     @action setMainPhoto=async(photo:IPhoto) => {\r\n         this.loading=true;\r\n         try {\r\n             await agent.Profiles.setMainPhoto(photo.id);\r\n             runInAction(() => {\r\n                 this.rootStore.userStore.user!.image=photo.url;\r\n                 this.profile!.photos.find(a=>a.isMain)!.isMain=false;\r\n                 this.profile!.photos.find(a=>a.id === photo.id)!.isMain =true;\r\n                 this.profile!.image=photo.url;\r\n                 this.loading=false;\r\n\r\n             })\r\n         } catch (error) {\r\n             toast.error('Problem setting photo as main');\r\n             runInAction(() => {\r\n                 this.loading=false;\r\n             })\r\n         }\r\n     }\r\n     @action deletePhoto= async(photo:IPhoto) => {\r\n         this.loading=true;\r\n         try {\r\n             await agent.Profiles.deletePhoto(photo.id);\r\n            runInAction(() => {\r\n                this.profile!.photos = this.profile!.photos.filter(a=>a.id !== photo.id);\r\n                this.loading=false;\r\n            })\r\n         } catch (error) {\r\n            toast.error('Problem deleting photo ');\r\n            runInAction(() => {\r\n                this.loading=false;\r\n            })\r\n         }\r\n     }\r\n\r\n     @action updateProfile = async (profile: Partial<IProfile>) => {\r\n        try {\r\n          await agent.Profiles.updateProfile(profile);\r\n          runInAction(() => {\r\n            if (\r\n              profile.display !== this.rootStore.userStore.user!.display\r\n            ) {\r\n              this.rootStore.userStore.user!.display = profile.display!;\r\n            }\r\n            this.profile = { ...this.profile!, ...profile };\r\n          });\r\n        } catch (error) {\r\n          toast.error('Problem updating profile');\r\n        }\r\n      };\r\n}"]},"metadata":{},"sourceType":"module"}