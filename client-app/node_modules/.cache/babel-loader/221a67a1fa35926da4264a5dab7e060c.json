{"ast":null,"code":"/**\n * @ag-grid-community/core - Advanced Data Grid / Data Table supporting Javascript / React / AngularJS / Web Components\n * @version v22.1.1\n * @link http://www.ag-grid.com/\n * @license MIT\n */\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nvar __param = this && this.__param || function (paramIndex, decorator) {\n  return function (target, key) {\n    decorator(target, key, paramIndex);\n  };\n};\n\nimport { RowNodeBlock } from \"./rowNodeBlock\";\nimport { Qualifier } from \"../../context/context\";\nimport { _ } from \"../../utils\";\n\nvar RowNodeBlockLoader =\n/** @class */\nfunction () {\n  function RowNodeBlockLoader(maxConcurrentRequests, blockLoadDebounceMillis) {\n    this.activeBlockLoadsCount = 0;\n    this.blocks = [];\n    this.active = true;\n    this.maxConcurrentRequests = maxConcurrentRequests;\n\n    if (blockLoadDebounceMillis && blockLoadDebounceMillis > 0) {\n      this.checkBlockToLoadDebounce = _.debounce(this.performCheckBlocksToLoad.bind(this), blockLoadDebounceMillis);\n    }\n  }\n\n  RowNodeBlockLoader.prototype.setBeans = function (loggerFactory) {\n    this.logger = loggerFactory.create('RowNodeBlockLoader');\n  };\n\n  RowNodeBlockLoader.prototype.addBlock = function (block) {\n    this.blocks.push(block);\n  };\n\n  RowNodeBlockLoader.prototype.removeBlock = function (block) {\n    _.removeFromArray(this.blocks, block);\n  };\n\n  RowNodeBlockLoader.prototype.destroy = function () {\n    this.active = false;\n  };\n\n  RowNodeBlockLoader.prototype.loadComplete = function () {\n    this.activeBlockLoadsCount--;\n  };\n\n  RowNodeBlockLoader.prototype.checkBlockToLoad = function () {\n    if (this.checkBlockToLoadDebounce) {\n      this.checkBlockToLoadDebounce();\n    } else {\n      this.performCheckBlocksToLoad();\n    }\n  };\n\n  RowNodeBlockLoader.prototype.performCheckBlocksToLoad = function () {\n    if (!this.active) {\n      return;\n    }\n\n    this.printCacheStatus();\n\n    if (this.activeBlockLoadsCount >= this.maxConcurrentRequests) {\n      this.logger.log(\"checkBlockToLoad: max loads exceeded\");\n      return;\n    }\n\n    var blockToLoad = null;\n    this.blocks.forEach(function (block) {\n      if (block.getState() === RowNodeBlock.STATE_DIRTY) {\n        blockToLoad = block;\n      }\n    });\n\n    if (blockToLoad) {\n      blockToLoad.load();\n      this.activeBlockLoadsCount++;\n      this.logger.log(\"checkBlockToLoad: loading page \" + blockToLoad.getBlockNumber());\n      this.printCacheStatus();\n    } else {\n      this.logger.log(\"checkBlockToLoad: no pages to load\");\n    }\n  };\n\n  RowNodeBlockLoader.prototype.getBlockState = function () {\n    var result = {};\n    this.blocks.forEach(function (block) {\n      var nodeIdPrefix = block.getNodeIdPrefix();\n      var stateItem = {\n        blockNumber: block.getBlockNumber(),\n        startRow: block.getStartRow(),\n        endRow: block.getEndRow(),\n        pageStatus: block.getState()\n      };\n\n      if (_.exists(nodeIdPrefix)) {\n        result[nodeIdPrefix + block.getBlockNumber()] = stateItem;\n      } else {\n        result[block.getBlockNumber()] = stateItem;\n      }\n    });\n    return result;\n  };\n\n  RowNodeBlockLoader.prototype.printCacheStatus = function () {\n    if (this.logger.isLogging()) {\n      this.logger.log(\"printCacheStatus: activePageLoadsCount = \" + this.activeBlockLoadsCount + \",\" + (\" blocks = \" + JSON.stringify(this.getBlockState())));\n    }\n  };\n\n  RowNodeBlockLoader.prototype.isLoading = function () {\n    return this.activeBlockLoadsCount > 0;\n  };\n\n  __decorate([__param(0, Qualifier('loggerFactory'))], RowNodeBlockLoader.prototype, \"setBeans\", null);\n\n  return RowNodeBlockLoader;\n}();\n\nexport { RowNodeBlockLoader };","map":null,"metadata":{},"sourceType":"module"}