{"ast":null,"code":"import _objectSpread from\"C:\\\\Projects\\\\Reactivities\\\\client-app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"C:\\\\Projects\\\\Reactivities\\\\client-app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"C:\\\\Projects\\\\Reactivities\\\\client-app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _initializerDefineProperty from\"C:\\\\Projects\\\\Reactivities\\\\client-app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/initializerDefineProperty\";import _classCallCheck from\"C:\\\\Projects\\\\Reactivities\\\\client-app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"C:\\\\Projects\\\\Reactivities\\\\client-app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _applyDecoratedDescriptor from\"C:\\\\Projects\\\\Reactivities\\\\client-app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/applyDecoratedDescriptor\";import _initializerWarningHelper from\"C:\\\\Projects\\\\Reactivities\\\\client-app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/initializerWarningHelper\";var _class,_descriptor,_descriptor2,_descriptor3,_descriptor4,_descriptor5,_descriptor6,_descriptor7,_descriptor8,_descriptor9,_descriptor10,_descriptor11,_descriptor12,_descriptor13,_descriptor14,_descriptor15,_descriptor16,_descriptor17,_descriptor18,_temp;import{observable,action,runInAction,computed,reaction}from\"mobx\";import agent from\"../api/agent\";import{toast}from\"react-toastify\";var ProfileStore=(_class=(_temp=/*#__PURE__*/function(){function ProfileStore(rootStore){var _this=this;_classCallCheck(this,ProfileStore);this.rootStore=void 0;_initializerDefineProperty(this,\"profile\",_descriptor,this);_initializerDefineProperty(this,\"loadingProfile\",_descriptor2,this);_initializerDefineProperty(this,\"uploadingPhoto\",_descriptor3,this);_initializerDefineProperty(this,\"loading\",_descriptor4,this);_initializerDefineProperty(this,\"followings\",_descriptor5,this);_initializerDefineProperty(this,\"activeTab\",_descriptor6,this);_initializerDefineProperty(this,\"userActivities\",_descriptor7,this);_initializerDefineProperty(this,\"loadingActivities\",_descriptor8,this);_initializerDefineProperty(this,\"loadUserActivities\",_descriptor9,this);_initializerDefineProperty(this,\"setActiveTab\",_descriptor10,this);_initializerDefineProperty(this,\"loadProfile\",_descriptor11,this);_initializerDefineProperty(this,\"uploadPhoto\",_descriptor12,this);_initializerDefineProperty(this,\"setMainPhoto\",_descriptor13,this);_initializerDefineProperty(this,\"deletePhoto\",_descriptor14,this);_initializerDefineProperty(this,\"updateProfile\",_descriptor15,this);_initializerDefineProperty(this,\"follow\",_descriptor16,this);_initializerDefineProperty(this,\"unfollow\",_descriptor17,this);_initializerDefineProperty(this,\"loadFollowings\",_descriptor18,this);this.rootStore=rootStore;reaction(function(){return _this.activeTab;},function(activeTab){if(activeTab===3||activeTab===4){var predicate=activeTab===3?'followers':'following';_this.loadFollowings(predicate);}else{_this.followings=[];}});}_createClass(ProfileStore,[{key:\"isCurrentUser\",get:function get(){if(this.rootStore.userStore.user&&this.profile){return this.rootStore.userStore.user.username===this.profile.userName;}else{return false;}}}]);return ProfileStore;}(),_temp),(_descriptor=_applyDecoratedDescriptor(_class.prototype,\"profile\",[observable],{configurable:true,enumerable:true,writable:true,initializer:function initializer(){return null;}}),_descriptor2=_applyDecoratedDescriptor(_class.prototype,\"loadingProfile\",[observable],{configurable:true,enumerable:true,writable:true,initializer:function initializer(){return true;}}),_descriptor3=_applyDecoratedDescriptor(_class.prototype,\"uploadingPhoto\",[observable],{configurable:true,enumerable:true,writable:true,initializer:function initializer(){return false;}}),_descriptor4=_applyDecoratedDescriptor(_class.prototype,\"loading\",[observable],{configurable:true,enumerable:true,writable:true,initializer:function initializer(){return false;}}),_descriptor5=_applyDecoratedDescriptor(_class.prototype,\"followings\",[observable],{configurable:true,enumerable:true,writable:true,initializer:function initializer(){return[];}}),_descriptor6=_applyDecoratedDescriptor(_class.prototype,\"activeTab\",[observable],{configurable:true,enumerable:true,writable:true,initializer:function initializer(){return 0;}}),_descriptor7=_applyDecoratedDescriptor(_class.prototype,\"userActivities\",[observable],{configurable:true,enumerable:true,writable:true,initializer:function initializer(){return[];}}),_descriptor8=_applyDecoratedDescriptor(_class.prototype,\"loadingActivities\",[observable],{configurable:true,enumerable:true,writable:true,initializer:function initializer(){return false;}}),_applyDecoratedDescriptor(_class.prototype,\"isCurrentUser\",[computed],Object.getOwnPropertyDescriptor(_class.prototype,\"isCurrentUser\"),_class.prototype),_descriptor9=_applyDecoratedDescriptor(_class.prototype,\"loadUserActivities\",[action],{configurable:true,enumerable:true,writable:true,initializer:function initializer(){var _this2=this;return/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(username,predicate){var activities;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_this2.loadingActivities=true;_context.prev=1;_context.next=4;return agent.Profiles.listActivities(username,predicate);case 4:activities=_context.sent;runInAction(function(){_this2.userActivities=activities;_this2.loadingActivities=false;});_context.next=12;break;case 8:_context.prev=8;_context.t0=_context[\"catch\"](1);toast.error('Problem loading activities');runInAction(function(){_this2.loadingActivities=false;});case 12:case\"end\":return _context.stop();}}},_callee,null,[[1,8]]);}));return function(_x,_x2){return _ref.apply(this,arguments);};}();}}),_descriptor10=_applyDecoratedDescriptor(_class.prototype,\"setActiveTab\",[action],{configurable:true,enumerable:true,writable:true,initializer:function initializer(){var _this3=this;return function(activeIndex){_this3.activeTab=activeIndex;};}}),_descriptor11=_applyDecoratedDescriptor(_class.prototype,\"loadProfile\",[action],{configurable:true,enumerable:true,writable:true,initializer:function initializer(){var _this4=this;return/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(userName){var profile;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return agent.Profiles.get(userName);case 3:profile=_context2.sent;runInAction(function(){_this4.profile=profile;_this4.loadingProfile=false;});_context2.next=11;break;case 7:_context2.prev=7;_context2.t0=_context2[\"catch\"](0);runInAction(function(){_this4.loadingProfile=false;});console.log(_context2.t0);case 11:case\"end\":return _context2.stop();}}},_callee2,null,[[0,7]]);}));return function(_x3){return _ref2.apply(this,arguments);};}();}}),_descriptor12=_applyDecoratedDescriptor(_class.prototype,\"uploadPhoto\",[action],{configurable:true,enumerable:true,writable:true,initializer:function initializer(){var _this5=this;return/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(file){var photo;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_this5.uploadingPhoto=true;_context3.prev=1;_context3.next=4;return agent.Profiles.uploadPhoto(file);case 4:photo=_context3.sent;runInAction(function(){if(_this5.profile){_this5.profile.photos.push(photo);if(photo.isMain&&_this5.rootStore.userStore.user){_this5.rootStore.userStore.user.image=photo.url;_this5.profile.image=photo.url;}}_this5.uploadingPhoto=false;});_context3.next=13;break;case 8:_context3.prev=8;_context3.t0=_context3[\"catch\"](1);console.log(_context3.t0);toast.error(\"uploading problem photo\");runInAction(function(){_this5.uploadingPhoto=false;});case 13:case\"end\":return _context3.stop();}}},_callee3,null,[[1,8]]);}));return function(_x4){return _ref3.apply(this,arguments);};}();}}),_descriptor13=_applyDecoratedDescriptor(_class.prototype,\"setMainPhoto\",[action],{configurable:true,enumerable:true,writable:true,initializer:function initializer(){var _this6=this;return/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(photo){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_this6.loading=true;_context4.prev=1;_context4.next=4;return agent.Profiles.setMainPhoto(photo.id);case 4:runInAction(function(){_this6.rootStore.userStore.user.image=photo.url;_this6.profile.photos.find(function(a){return a.isMain;}).isMain=false;_this6.profile.photos.find(function(a){return a.id===photo.id;}).isMain=true;_this6.profile.image=photo.url;_this6.loading=false;});_context4.next=11;break;case 7:_context4.prev=7;_context4.t0=_context4[\"catch\"](1);toast.error(\"Problem setting photo as main\");runInAction(function(){_this6.loading=false;});case 11:case\"end\":return _context4.stop();}}},_callee4,null,[[1,7]]);}));return function(_x5){return _ref4.apply(this,arguments);};}();}}),_descriptor14=_applyDecoratedDescriptor(_class.prototype,\"deletePhoto\",[action],{configurable:true,enumerable:true,writable:true,initializer:function initializer(){var _this7=this;return/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(photo){return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_this7.loading=true;_context5.prev=1;_context5.next=4;return agent.Profiles.deletePhoto(photo.id);case 4:runInAction(function(){_this7.profile.photos=_this7.profile.photos.filter(function(a){return a.id!==photo.id;});_this7.loading=false;});_context5.next=11;break;case 7:_context5.prev=7;_context5.t0=_context5[\"catch\"](1);toast.error(\"Problem deleting photo \");runInAction(function(){_this7.loading=false;});case 11:case\"end\":return _context5.stop();}}},_callee5,null,[[1,7]]);}));return function(_x6){return _ref5.apply(this,arguments);};}();}}),_descriptor15=_applyDecoratedDescriptor(_class.prototype,\"updateProfile\",[action],{configurable:true,enumerable:true,writable:true,initializer:function initializer(){var _this8=this;return/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(profile){return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_context6.prev=0;_context6.next=3;return agent.Profiles.updateProfile(profile);case 3:runInAction(function(){if(profile.display!==_this8.rootStore.userStore.user.display){_this8.rootStore.userStore.user.display=profile.display;}_this8.profile=_objectSpread(_objectSpread({},_this8.profile),profile);});_context6.next=9;break;case 6:_context6.prev=6;_context6.t0=_context6[\"catch\"](0);toast.error(\"Problem updating profile\");case 9:case\"end\":return _context6.stop();}}},_callee6,null,[[0,6]]);}));return function(_x7){return _ref6.apply(this,arguments);};}();}}),_descriptor16=_applyDecoratedDescriptor(_class.prototype,\"follow\",[action],{configurable:true,enumerable:true,writable:true,initializer:function initializer(){var _this9=this;return/*#__PURE__*/function(){var _ref7=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7(username){return _regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:_this9.loading=true;_context7.prev=1;_context7.next=4;return agent.Profiles.follow(username);case 4:runInAction(function(){_this9.profile.following=true;_this9.profile.followersCount++;_this9.loading=false;});_context7.next=11;break;case 7:_context7.prev=7;_context7.t0=_context7[\"catch\"](1);toast.error(\"Problem following user\");runInAction(function(){_this9.loading=false;});case 11:case\"end\":return _context7.stop();}}},_callee7,null,[[1,7]]);}));return function(_x8){return _ref7.apply(this,arguments);};}();}}),_descriptor17=_applyDecoratedDescriptor(_class.prototype,\"unfollow\",[action],{configurable:true,enumerable:true,writable:true,initializer:function initializer(){var _this10=this;return/*#__PURE__*/function(){var _ref8=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee8(username){return _regeneratorRuntime.wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:_this10.loading=true;_context8.prev=1;_context8.next=4;return agent.Profiles.unfollow(username);case 4:runInAction(function(){_this10.profile.following=false;_this10.profile.followersCount--;_this10.loading=false;});_context8.next=11;break;case 7:_context8.prev=7;_context8.t0=_context8[\"catch\"](1);toast.error(\"Problem unfollowing user\");runInAction(function(){_this10.loading=false;});case 11:case\"end\":return _context8.stop();}}},_callee8,null,[[1,7]]);}));return function(_x9){return _ref8.apply(this,arguments);};}();}}),_descriptor18=_applyDecoratedDescriptor(_class.prototype,\"loadFollowings\",[action],{configurable:true,enumerable:true,writable:true,initializer:function initializer(){var _this11=this;return/*#__PURE__*/function(){var _ref9=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee9(predicate){var profiles;return _regeneratorRuntime.wrap(function _callee9$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:_this11.loading=true;_context9.prev=1;_context9.next=4;return agent.Profiles.listFollowings(_this11.profile.userName,predicate);case 4:profiles=_context9.sent;runInAction(function(){_this11.followings=profiles;_this11.loading=false;});_context9.next=12;break;case 8:_context9.prev=8;_context9.t0=_context9[\"catch\"](1);toast.error('Problem loading followings');runInAction(function(){_this11.loading=false;});case 12:case\"end\":return _context9.stop();}}},_callee9,null,[[1,8]]);}));return function(_x10){return _ref9.apply(this,arguments);};}();}})),_class);export{ProfileStore as default};","map":{"version":3,"sources":["C:/Projects/Reactivities/client-app/src/app/stores/profileStore.ts"],"names":["observable","action","runInAction","computed","reaction","agent","toast","ProfileStore","rootStore","activeTab","predicate","loadFollowings","followings","userStore","user","profile","username","userName","loadingActivities","Profiles","listActivities","activities","userActivities","error","activeIndex","get","loadingProfile","console","log","file","uploadingPhoto","uploadPhoto","photo","photos","push","isMain","image","url","loading","setMainPhoto","id","find","a","deletePhoto","filter","updateProfile","display","follow","following","followersCount","unfollow","listFollowings","profiles"],"mappings":"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","sourcesContent":["import { RootStore } from \"./rootStore\";\r\nimport { IProfile, IPhoto, IUserActivity } from \"../models/profile\";\r\nimport { observable, action, runInAction, computed, reaction } from \"mobx\";\r\nimport agent from \"../api/agent\";\r\nimport { toast } from \"react-toastify\";\r\n\r\nexport default class ProfileStore {\r\n  rootStore: RootStore;\r\n  constructor(rootStore: RootStore) {\r\n    this.rootStore = rootStore;\r\n\r\n    reaction(\r\n      ()=> this.activeTab,\r\n      activeTab => {\r\n        if (activeTab===3 || activeTab ===4) {\r\n          const predicate =activeTab===3 ? 'followers':'following';\r\n          this.loadFollowings(predicate)\r\n        }else {\r\n          this.followings=[];\r\n        }\r\n      }\r\n    )\r\n  }\r\n  @observable profile: IProfile | null = null;\r\n  @observable loadingProfile = true;\r\n  @observable uploadingPhoto = false;\r\n  @observable loading = false;\r\n  @observable followings: IProfile[] = [];\r\n  @observable activeTab: number = 0;\r\n  @observable userActivities:IUserActivity[] = []\r\n  @observable loadingActivities = false;\r\n\r\n  @computed get isCurrentUser() {\r\n    if (this.rootStore.userStore.user && this.profile) {\r\n      return this.rootStore.userStore.user.username === this.profile.userName;\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  @action loadUserActivities = async (username: string, predicate?: string) => {\r\n    this.loadingActivities = true;\r\n    try {\r\n       const activities = await agent.Profiles.listActivities(username, predicate!);\r\n       runInAction(() => {\r\n        this.userActivities = activities;\r\n        this.loadingActivities = false;\r\n      })\r\n    } catch (error) {\r\n      toast.error('Problem loading activities')\r\n      runInAction(() => {\r\n        this.loadingActivities = false;\r\n      })\r\n    }\r\n  }\r\n\r\n  @action setActiveTab= (activeIndex: number) => {\r\n    this.activeTab=activeIndex;\r\n  }\r\n  @action loadProfile = async (userName: string) => {\r\n    try {\r\n      const profile = await agent.Profiles.get(userName);\r\n      runInAction(() => {\r\n        this.profile = profile;\r\n\r\n        this.loadingProfile = false;\r\n      });\r\n    } catch (error) {\r\n      runInAction(() => {\r\n        this.loadingProfile = false;\r\n      });\r\n      console.log(error);\r\n    }\r\n  };\r\n\r\n  @action uploadPhoto = async (file: Blob) => {\r\n    this.uploadingPhoto = true;\r\n    try {\r\n      const photo = await agent.Profiles.uploadPhoto(file);\r\n      runInAction(() => {\r\n        if (this.profile) {\r\n          this.profile.photos.push(photo);\r\n          if (photo.isMain && this.rootStore.userStore.user) {\r\n            this.rootStore.userStore.user.image = photo.url;\r\n            this.profile.image = photo.url;\r\n          }\r\n        }\r\n        this.uploadingPhoto = false;\r\n      });\r\n    } catch (error) {\r\n      console.log(error);\r\n      toast.error(\"uploading problem photo\");\r\n      runInAction(() => {\r\n        this.uploadingPhoto = false;\r\n      });\r\n    }\r\n  };\r\n  @action setMainPhoto = async (photo: IPhoto) => {\r\n    this.loading = true;\r\n    try {\r\n      await agent.Profiles.setMainPhoto(photo.id);\r\n      runInAction(() => {\r\n        this.rootStore.userStore.user!.image = photo.url;\r\n        this.profile!.photos.find((a) => a.isMain)!.isMain = false;\r\n        this.profile!.photos.find((a) => a.id === photo.id)!.isMain = true;\r\n        this.profile!.image = photo.url;\r\n        this.loading = false;\r\n      });\r\n    } catch (error) {\r\n      toast.error(\"Problem setting photo as main\");\r\n      runInAction(() => {\r\n        this.loading = false;\r\n      });\r\n    }\r\n  };\r\n  @action deletePhoto = async (photo: IPhoto) => {\r\n    this.loading = true;\r\n    try {\r\n      await agent.Profiles.deletePhoto(photo.id);\r\n      runInAction(() => {\r\n        this.profile!.photos = this.profile!.photos.filter(\r\n          (a) => a.id !== photo.id\r\n        );\r\n        this.loading = false;\r\n      });\r\n    } catch (error) {\r\n      toast.error(\"Problem deleting photo \");\r\n      runInAction(() => {\r\n        this.loading = false;\r\n      });\r\n    }\r\n  };\r\n\r\n  @action updateProfile = async (profile: Partial<IProfile>) => {\r\n    try {\r\n      await agent.Profiles.updateProfile(profile);\r\n      runInAction(() => {\r\n        if (profile.display !== this.rootStore.userStore.user!.display) {\r\n          this.rootStore.userStore.user!.display = profile.display!;\r\n        }\r\n        this.profile = { ...this.profile!, ...profile };\r\n      });\r\n    } catch (error) {\r\n      toast.error(\"Problem updating profile\");\r\n    }\r\n  };\r\n  @action follow = async (username: string) => {\r\n    this.loading = true;\r\n    try {\r\n      await agent.Profiles.follow(username);\r\n      runInAction(() => {\r\n        this.profile!.following = true;\r\n        this.profile!.followersCount++;\r\n        this.loading = false;\r\n      });\r\n    } catch (error) {\r\n      toast.error(\"Problem following user\");\r\n      runInAction(() => {\r\n        this.loading = false;\r\n      });\r\n    }\r\n  };\r\n\r\n  @action unfollow = async (username: string) => {\r\n    this.loading = true;\r\n    try {\r\n      await agent.Profiles.unfollow(username);\r\n      runInAction(() => {\r\n        this.profile!.following = false;\r\n        this.profile!.followersCount--;\r\n        this.loading = false;\r\n      });\r\n    } catch (error) {\r\n      toast.error(\"Problem unfollowing user\");\r\n      runInAction(() => {\r\n        this.loading = false;\r\n      });\r\n    }\r\n  };\r\n\r\n  @action loadFollowings = async (predicate: string) => {\r\n    this.loading = true;\r\n    try {\r\n      const profiles = await agent.Profiles.listFollowings(\r\n        this.profile!.userName,\r\n        predicate\r\n      );\r\n      runInAction(() => {\r\n          this.followings = profiles;\r\n          this.loading = false;\r\n      })\r\n    } catch (error) {\r\n      toast.error('Problem loading followings');\r\n      runInAction(() => {\r\n        this.loading = false;\r\n      });\r\n    }\r\n  };\r\n}\r\n"]},"metadata":{},"sourceType":"module"}