{"ast":null,"code":"import _regeneratorRuntime from\"C:\\\\Projects\\\\Reactivities\\\\client-app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"C:\\\\Projects\\\\Reactivities\\\\client-app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _toConsumableArray from\"C:\\\\Projects\\\\Reactivities\\\\client-app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/toConsumableArray\";import _initializerDefineProperty from\"C:\\\\Projects\\\\Reactivities\\\\client-app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/initializerDefineProperty\";import _classCallCheck from\"C:\\\\Projects\\\\Reactivities\\\\client-app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"C:\\\\Projects\\\\Reactivities\\\\client-app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _applyDecoratedDescriptor from\"C:\\\\Projects\\\\Reactivities\\\\client-app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/applyDecoratedDescriptor\";import _initializerWarningHelper from\"C:\\\\Projects\\\\Reactivities\\\\client-app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/initializerWarningHelper\";var _dec,_class,_descriptor,_descriptor2,_descriptor3,_descriptor4,_descriptor5,_descriptor6,_descriptor7,_descriptor8,_descriptor9,_descriptor10,_descriptor11,_descriptor12,_descriptor13,_descriptor14,_descriptor15,_descriptor16,_descriptor17,_descriptor18,_temp;import{observable,action,computed,runInAction}from\"mobx\";import agent from\"../api/agent\";import{history}from\"../..\";import{toast}from\"react-toastify\";import{setActivityProps,createAttendee}from\"../common/util/util\";import{HubConnectionBuilder,LogLevel}from\"@aspnet/signalr\";var ActivityStore=(_dec=observable.ref,(_class=(_temp=/*#__PURE__*/function(){function ActivityStore(rootStore){var _this=this;_classCallCheck(this,ActivityStore);this.rootStore=void 0;_initializerDefineProperty(this,\"activityRegistry\",_descriptor,this);_initializerDefineProperty(this,\"activity\",_descriptor2,this);_initializerDefineProperty(this,\"loadingInitial\",_descriptor3,this);_initializerDefineProperty(this,\"submitting\",_descriptor4,this);_initializerDefineProperty(this,\"target\",_descriptor5,this);_initializerDefineProperty(this,\"loading\",_descriptor6,this);_initializerDefineProperty(this,\"hubConnection\",_descriptor7,this);_initializerDefineProperty(this,\"createHubConnection\",_descriptor8,this);_initializerDefineProperty(this,\"stopHubConnection\",_descriptor9,this);_initializerDefineProperty(this,\"addComment\",_descriptor10,this);_initializerDefineProperty(this,\"loadActivities\",_descriptor11,this);_initializerDefineProperty(this,\"loadActivity\",_descriptor12,this);_initializerDefineProperty(this,\"clearActivity\",_descriptor13,this);this.getActivity=function(id){return _this.activityRegistry.get(id);};_initializerDefineProperty(this,\"createActivity\",_descriptor14,this);_initializerDefineProperty(this,\"editActivity\",_descriptor15,this);_initializerDefineProperty(this,\"deleteActivity\",_descriptor16,this);_initializerDefineProperty(this,\"attendActivity\",_descriptor17,this);_initializerDefineProperty(this,\"cancelAttendance\",_descriptor18,this);this.rootStore=rootStore;}_createClass(ActivityStore,[{key:\"groupActivitiesByDate\",value:function groupActivitiesByDate(activities){var sortedActivities=activities.sort(function(a,b){return a.date.getTime()-b.date.getTime();});return Object.entries(sortedActivities.reduce(function(activities,activity){var date=activity.date.toISOString().split(\"T\")[0];activities[date]=activities[date]?[].concat(_toConsumableArray(activities[date]),[activity]):[activity];return activities;},{}));}},{key:\"activitiesByDate\",get:function get(){return this.groupActivitiesByDate(Array.from(this.activityRegistry.values()));}}]);return ActivityStore;}(),_temp),(_descriptor=_applyDecoratedDescriptor(_class.prototype,\"activityRegistry\",[observable],{configurable:true,enumerable:true,writable:true,initializer:function initializer(){return new Map();}}),_descriptor2=_applyDecoratedDescriptor(_class.prototype,\"activity\",[observable],{configurable:true,enumerable:true,writable:true,initializer:function initializer(){return null;}}),_descriptor3=_applyDecoratedDescriptor(_class.prototype,\"loadingInitial\",[observable],{configurable:true,enumerable:true,writable:true,initializer:function initializer(){return false;}}),_descriptor4=_applyDecoratedDescriptor(_class.prototype,\"submitting\",[observable],{configurable:true,enumerable:true,writable:true,initializer:function initializer(){return false;}}),_descriptor5=_applyDecoratedDescriptor(_class.prototype,\"target\",[observable],{configurable:true,enumerable:true,writable:true,initializer:function initializer(){return\"\";}}),_descriptor6=_applyDecoratedDescriptor(_class.prototype,\"loading\",[observable],{configurable:true,enumerable:true,writable:true,initializer:function initializer(){return false;}}),_descriptor7=_applyDecoratedDescriptor(_class.prototype,\"hubConnection\",[_dec],{configurable:true,enumerable:true,writable:true,initializer:function initializer(){return null;}}),_descriptor8=_applyDecoratedDescriptor(_class.prototype,\"createHubConnection\",[action],{configurable:true,enumerable:true,writable:true,initializer:function initializer(){var _this2=this;return function(){_this2.hubConnection=new HubConnectionBuilder().withUrl(\"http://localhost:5000/chat\",{accessTokenFactory:function accessTokenFactory(){return _this2.rootStore.commonStore.token;}}).configureLogging(LogLevel.Information).build();_this2.hubConnection.start().then(function(){return console.log(_this2.hubConnection.state);}).catch(function(error){return console.log(\"Error establishing connection : \",error);});_this2.hubConnection.on('ReceiveComment',function(comment){_this2.activity.comments.push(comment);});};}}),_descriptor9=_applyDecoratedDescriptor(_class.prototype,\"stopHubConnection\",[action],{configurable:true,enumerable:true,writable:true,initializer:function initializer(){var _this3=this;return function(){_this3.hubConnection.stop();};}}),_descriptor10=_applyDecoratedDescriptor(_class.prototype,\"addComment\",[action],{configurable:true,enumerable:true,writable:true,initializer:function initializer(){var _this4=this;return/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(values){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:values.activityId=_this4.activity.id;_context.prev=1;_context.next=4;return _this4.hubConnection.invoke('SendComment',values);case 4:_context.next=9;break;case 6:_context.prev=6;_context.t0=_context[\"catch\"](1);console.error(_context.t0);case 9:case\"end\":return _context.stop();}}},_callee,null,[[1,6]]);}));return function(_x){return _ref.apply(this,arguments);};}();}}),_applyDecoratedDescriptor(_class.prototype,\"activitiesByDate\",[computed],Object.getOwnPropertyDescriptor(_class.prototype,\"activitiesByDate\"),_class.prototype),_descriptor11=_applyDecoratedDescriptor(_class.prototype,\"loadActivities\",[action],{configurable:true,enumerable:true,writable:true,initializer:function initializer(){var _this5=this;return/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var activities;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_this5.loadingInitial=true;_context2.prev=1;_context2.next=4;return agent.Activities.list();case 4:activities=_context2.sent;runInAction(\"loading activities\",function(){activities.forEach(function(activity){setActivityProps(activity,_this5.rootStore.userStore.user);_this5.activityRegistry.set(activity.id,activity);});_this5.loadingInitial=false;});_context2.next=11;break;case 8:_context2.prev=8;_context2.t0=_context2[\"catch\"](1);runInAction(\"load activities error\",function(){_this5.loadingInitial=false;});case 11:case\"end\":return _context2.stop();}}},_callee2,null,[[1,8]]);}));}}),_descriptor12=_applyDecoratedDescriptor(_class.prototype,\"loadActivity\",[action],{configurable:true,enumerable:true,writable:true,initializer:function initializer(){var _this6=this;return/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(id){var activity;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:activity=_this6.getActivity(id);if(!activity){_context3.next=6;break;}_this6.activity=activity;return _context3.abrupt(\"return\",activity);case 6:_this6.loadingInitial=true;_context3.prev=7;_context3.next=10;return agent.Activities.details(id);case 10:activity=_context3.sent;runInAction(\"getting activity\",function(){setActivityProps(activity,_this6.rootStore.userStore.user);_this6.activity=activity;_this6.activityRegistry.set(activity.id,activity);_this6.loadingInitial=false;});return _context3.abrupt(\"return\",activity);case 15:_context3.prev=15;_context3.t0=_context3[\"catch\"](7);runInAction(\"get activity error\",function(){_this6.loadingInitial=false;});console.log(_context3.t0);case 19:case\"end\":return _context3.stop();}}},_callee3,null,[[7,15]]);}));return function(_x2){return _ref3.apply(this,arguments);};}();}}),_descriptor13=_applyDecoratedDescriptor(_class.prototype,\"clearActivity\",[action],{configurable:true,enumerable:true,writable:true,initializer:function initializer(){var _this7=this;return function(){_this7.activity=null;};}}),_descriptor14=_applyDecoratedDescriptor(_class.prototype,\"createActivity\",[action],{configurable:true,enumerable:true,writable:true,initializer:function initializer(){var _this8=this;return/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(activity){var attendee,attendees;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_this8.submitting=true;_context4.prev=1;_context4.next=4;return agent.Activities.create(activity);case 4:attendee=createAttendee(_this8.rootStore.userStore.user);attendee.isHost=true;attendees=[];attendees.push(attendee);activity.attendees=attendees;activity.isHost=true;runInAction(\"create activity\",function(){_this8.activityRegistry.set(activity.id,activity);_this8.submitting=false;});history.push(\"/activities/\".concat(activity.id));_context4.next=19;break;case 14:_context4.prev=14;_context4.t0=_context4[\"catch\"](1);runInAction(\"create activity error\",function(){_this8.submitting=false;});toast.error(\"Problem submitting data\");console.log(_context4.t0.response);case 19:case\"end\":return _context4.stop();}}},_callee4,null,[[1,14]]);}));return function(_x3){return _ref4.apply(this,arguments);};}();}}),_descriptor15=_applyDecoratedDescriptor(_class.prototype,\"editActivity\",[action],{configurable:true,enumerable:true,writable:true,initializer:function initializer(){var _this9=this;return/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(activity){return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_this9.submitting=true;_context5.prev=1;_context5.next=4;return agent.Activities.update(activity);case 4:runInAction(\"editing activity\",function(){_this9.activityRegistry.set(activity.id,activity);_this9.activity=activity;_this9.submitting=false;});history.push(\"/activities/\".concat(activity.id));_context5.next=13;break;case 8:_context5.prev=8;_context5.t0=_context5[\"catch\"](1);runInAction(\"edit activity error\",function(){_this9.submitting=false;});toast.error(\"Problem submitting data\");console.log(_context5.t0);case 13:case\"end\":return _context5.stop();}}},_callee5,null,[[1,8]]);}));return function(_x4){return _ref5.apply(this,arguments);};}();}}),_descriptor16=_applyDecoratedDescriptor(_class.prototype,\"deleteActivity\",[action],{configurable:true,enumerable:true,writable:true,initializer:function initializer(){var _this10=this;return/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(event,id){return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_this10.submitting=true;_this10.target=event.currentTarget.name;_context6.prev=2;_context6.next=5;return agent.Activities.delete(id);case 5:runInAction(\"deleting activity\",function(){_this10.activityRegistry.delete(id);_this10.submitting=false;_this10.target=\"\";});_context6.next=12;break;case 8:_context6.prev=8;_context6.t0=_context6[\"catch\"](2);runInAction(\"delete activity error\",function(){_this10.submitting=false;_this10.target=\"\";});console.log(_context6.t0);case 12:case\"end\":return _context6.stop();}}},_callee6,null,[[2,8]]);}));return function(_x5,_x6){return _ref6.apply(this,arguments);};}();}}),_descriptor17=_applyDecoratedDescriptor(_class.prototype,\"attendActivity\",[action],{configurable:true,enumerable:true,writable:true,initializer:function initializer(){var _this11=this;return/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7(){var attendee;return _regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:attendee=createAttendee(_this11.rootStore.userStore.user);_this11.loading=true;_context7.prev=2;_context7.next=5;return agent.Activities.attend(_this11.activity.id);case 5:runInAction(function(){if(_this11.activity){_this11.activity.attendees.push(attendee);_this11.activity.isGoing=true;_this11.activityRegistry.set(_this11.activity.id,_this11.activity);_this11.loading=false;}});_context7.next=12;break;case 8:_context7.prev=8;_context7.t0=_context7[\"catch\"](2);runInAction(function(){_this11.loading=false;});toast.error(\"Problem signing up to activity\");case 12:case\"end\":return _context7.stop();}}},_callee7,null,[[2,8]]);}));}}),_descriptor18=_applyDecoratedDescriptor(_class.prototype,\"cancelAttendance\",[action],{configurable:true,enumerable:true,writable:true,initializer:function initializer(){var _this12=this;return/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee8(){return _regeneratorRuntime.wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:_this12.loading=true;_context8.prev=1;_context8.next=4;return agent.Activities.unattend(_this12.activity.id);case 4:runInAction(function(){if(_this12.activity){_this12.activity.attendees=_this12.activity.attendees.filter(function(a){return a.userName!==_this12.rootStore.userStore.user.username;});_this12.activity.isGoing=false;_this12.activityRegistry.set(_this12.activity.id,_this12.activity);_this12.loading=false;}});_context8.next=11;break;case 7:_context8.prev=7;_context8.t0=_context8[\"catch\"](1);runInAction(function(){_this12.loading=false;});toast.error(\"Problem cancelling activity\");case 11:case\"end\":return _context8.stop();}}},_callee8,null,[[1,7]]);}));}})),_class));export{ActivityStore as default};","map":{"version":3,"sources":["C:/Projects/Reactivities/client-app/src/app/stores/activityStore.ts"],"names":["observable","action","computed","runInAction","agent","history","toast","setActivityProps","createAttendee","HubConnectionBuilder","LogLevel","ActivityStore","ref","rootStore","getActivity","id","activityRegistry","get","activities","sortedActivities","sort","a","b","date","getTime","Object","entries","reduce","activity","toISOString","split","groupActivitiesByDate","Array","from","values","Map","hubConnection","withUrl","accessTokenFactory","commonStore","token","configureLogging","Information","build","start","then","console","log","state","catch","error","on","comment","comments","push","stop","activityId","invoke","loadingInitial","Activities","list","forEach","userStore","user","set","details","submitting","create","attendee","isHost","attendees","response","update","event","target","currentTarget","name","delete","loading","attend","isGoing","unattend","filter","userName","username"],"mappings":"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","sourcesContent":["import { observable, action, computed, runInAction } from \"mobx\";\nimport { SyntheticEvent } from \"react\";\nimport { IActivity } from \"../models/activity\";\nimport agent from \"../api/agent\";\nimport { history } from \"../..\";\nimport { toast } from \"react-toastify\";\nimport { RootStore } from \"./rootStore\";\nimport { setActivityProps, createAttendee } from \"../common/util/util\";\n\nimport { HubConnection, HubConnectionBuilder, LogLevel } from \"@aspnet/signalr\";\n\nexport default class ActivityStore {\n  rootStore: RootStore;\n  constructor(rootStore: RootStore) {\n    this.rootStore = rootStore;\n  }\n\n  @observable activityRegistry = new Map();\n  @observable activity: IActivity | null = null;\n  @observable loadingInitial = false;\n  @observable submitting = false;\n  @observable target = \"\";\n  @observable loading = false;\n  @observable.ref hubConnection: HubConnection | null = null;\n\n  @action createHubConnection = () => {\n    this.hubConnection = new HubConnectionBuilder()\n      .withUrl(\"http://localhost:5000/chat\", {\n        accessTokenFactory: () => this.rootStore.commonStore.token!,\n      })\n      .configureLogging(LogLevel.Information)\n      .build();\n    this.hubConnection\n      .start()\n      .then(() => console.log(this.hubConnection!.state))\n      .catch((error) => console.log(\"Error establishing connection : \", error));\n\n      this.hubConnection.on('ReceiveComment',comment => {\n        this.activity!.comments.push(comment);\n      })\n  };\n\n  @action stopHubConnection = () => {\n    this.hubConnection!.stop();\n  }\n\n  @action addComment = async (values :any) => {\n    values.activityId=this.activity!.id;\n\n    try {\n      await this.hubConnection!.invoke('SendComment', values)\n    } catch (error) {\n      console.error(error);\n      \n    }\n  }\n\n  @computed get activitiesByDate() {\n    return this.groupActivitiesByDate(\n      Array.from(this.activityRegistry.values())\n    );\n  }\n\n  groupActivitiesByDate(activities: IActivity[]) {\n    const sortedActivities = activities.sort(\n      (a, b) => a.date.getTime() - b.date.getTime()\n    );\n    return Object.entries(\n      sortedActivities.reduce((activities, activity) => {\n        const date = activity.date.toISOString().split(\"T\")[0];\n        activities[date] = activities[date]\n          ? [...activities[date], activity]\n          : [activity];\n        return activities;\n      }, {} as { [key: string]: IActivity[] })\n    );\n  }\n\n  @action loadActivities = async () => {\n    this.loadingInitial = true;\n    try {\n      const activities = await agent.Activities.list();\n      runInAction(\"loading activities\", () => {\n        activities.forEach((activity) => {\n          setActivityProps(activity, this.rootStore.userStore.user!);\n          this.activityRegistry.set(activity.id, activity);\n        });\n        this.loadingInitial = false;\n      });\n    } catch (error) {\n      runInAction(\"load activities error\", () => {\n        this.loadingInitial = false;\n      });\n    }\n  };\n\n  @action loadActivity = async (id: string) => {\n    let activity = this.getActivity(id);\n    if (activity) {\n      this.activity = activity;\n      return activity;\n    } else {\n      this.loadingInitial = true;\n      try {\n        activity = await agent.Activities.details(id);\n        runInAction(\"getting activity\", () => {\n          setActivityProps(activity, this.rootStore.userStore.user!);\n          this.activity = activity;\n          this.activityRegistry.set(activity.id, activity);\n          this.loadingInitial = false;\n        });\n        return activity;\n      } catch (error) {\n        runInAction(\"get activity error\", () => {\n          this.loadingInitial = false;\n        });\n        console.log(error);\n      }\n    }\n  };\n\n  @action clearActivity = () => {\n    this.activity = null;\n  };\n\n  getActivity = (id: string) => {\n    return this.activityRegistry.get(id);\n  };\n\n  @action createActivity = async (activity: IActivity) => {\n    this.submitting = true;\n    try {\n      await agent.Activities.create(activity);\n      const attendee = createAttendee(this.rootStore.userStore.user!);\n      attendee.isHost = true;\n      let attendees = [];\n      attendees.push(attendee);\n      activity.attendees = attendees;\n      activity.isHost = true;\n      runInAction(\"create activity\", () => {\n        this.activityRegistry.set(activity.id, activity);\n        this.submitting = false;\n      });\n      history.push(`/activities/${activity.id}`);\n    } catch (error) {\n      runInAction(\"create activity error\", () => {\n        this.submitting = false;\n      });\n      toast.error(\"Problem submitting data\");\n      console.log(error.response);\n    }\n  };\n\n  @action editActivity = async (activity: IActivity) => {\n    this.submitting = true;\n    try {\n      await agent.Activities.update(activity);\n      runInAction(\"editing activity\", () => {\n        this.activityRegistry.set(activity.id, activity);\n        this.activity = activity;\n        this.submitting = false;\n      });\n      history.push(`/activities/${activity.id}`);\n    } catch (error) {\n      runInAction(\"edit activity error\", () => {\n        this.submitting = false;\n      });\n      toast.error(\"Problem submitting data\");\n      console.log(error);\n    }\n  };\n\n  @action deleteActivity = async (\n    event: SyntheticEvent<HTMLButtonElement>,\n    id: string\n  ) => {\n    this.submitting = true;\n    this.target = event.currentTarget.name;\n    try {\n      await agent.Activities.delete(id);\n      runInAction(\"deleting activity\", () => {\n        this.activityRegistry.delete(id);\n        this.submitting = false;\n        this.target = \"\";\n      });\n    } catch (error) {\n      runInAction(\"delete activity error\", () => {\n        this.submitting = false;\n        this.target = \"\";\n      });\n      console.log(error);\n    }\n  };\n\n  @action attendActivity = async () => {\n    const attendee = createAttendee(this.rootStore.userStore.user!);\n    this.loading = true;\n    try {\n      await agent.Activities.attend(this.activity!.id);\n      runInAction(() => {\n        if (this.activity) {\n          this.activity.attendees.push(attendee);\n          this.activity.isGoing = true;\n          this.activityRegistry.set(this.activity.id, this.activity);\n          this.loading = false;\n        }\n      });\n    } catch (error) {\n      runInAction(() => {\n        this.loading = false;\n      });\n      toast.error(\"Problem signing up to activity\");\n    }\n  };\n  @action cancelAttendance = async () => {\n    this.loading = true;\n\n    try {\n      await agent.Activities.unattend(this.activity!.id);\n\n      runInAction(() => {\n        if (this.activity) {\n          this.activity.attendees = this.activity.attendees.filter(\n            (a) => a.userName !== this.rootStore.userStore.user!.username\n          );\n          this.activity.isGoing = false;\n          this.activityRegistry.set(this.activity.id, this.activity);\n          this.loading = false;\n        }\n      });\n    } catch (error) {\n      runInAction(() => {\n        this.loading = false;\n      });\n      toast.error(\"Problem cancelling activity\");\n    }\n  };\n}\n"]},"metadata":{},"sourceType":"module"}